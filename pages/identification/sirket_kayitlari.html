
<script type="text/javascript">
    initLoadedPage();

    function initLoadedPage() {

        var grid = $("#grid-sirketler").bootgrid({
            ajax: false,
            formatters: {
                "commands": function(column, row)
                {
                    return "<button type=\"button\" class=\"btn btn-xs btn-default command-edit\" data-row-id=\"" + row.idSirket + "\"><span class=\"fa fa-pencil\"></span></button> " + 
                        "<button type=\"button\" class=\"btn btn-xs btn-default command-delete\" data-row-id=\"" + row.idSirket + "\"><span class=\"fa fa-trash-o\"></span></button>";
                }
            }
        }).on("loaded.rs.jquery.bootgrid", function()
        {
            /* Executes after data is loaded and rendered */
            grid.find(".command-edit").on("click", function(e)
            {
                var lstVeri= listTable("sirketler");
                var id=$(this).data("row-id");
                setEditRow(id);
                // console.log(lstVeri);
                // $("#hdnId").val(lstVeri.idSirket);
                // $("#txtSirketAdi").val(lstVeri.sirketAdi);
                // $("#txtSirketAdresi").val(lstVeri.sirketAdresi);
                // $("#txtSirketTelefon").val(lstVeri.sirketTelefon);
                // $("#txtSirketSGKSicilNo").val(lstVeri.sirketSGKSicilNo);
                // $("#txtSirketIlgiliKisi").val(lstVeri.sirketIlgiliKisi);
                // $("#txtSirketTelefonCep").val(lstVeri.sirketTelefonCep);
                // $("#txtSirketEposta").val(lstVeri.sirketEposta);
                // $("#txtSirketIsyeriHekimi").val(lstVeri.sirketIsyeriHekimi);
                // $("#txtSirketIsyeriGuvenlikUzmani").val(lstVeri.sirketIsGuvenligiUzmani);
                // $('#myModal').modal('show');
                // alert("You pressed edit on row: " + $(this).data("row-id"));

            }).end().find(".command-delete").on("click", function(e)
            {
                alert("You pressed delete on row: " + $(this).data("row-id"));
            });
        });

        firebase.database().ref('sirketler').once('value').then(function (snapshot) {

            console.log('test',snapshot);
            var rows = [];
            snapshot.forEach(function (element) {
                
                var cleanelement = JSON.parse(JSON.stringify(element));
                cleanelement['id'] = rows.length + 1;
                rows.push(cleanelement);
                 console.log('cleanelement',cleanelement);
            });

            grid.bootgrid("append", rows);
        });
    }

    function setEditRow(id){
         firebase.database().ref('/sirketler/' + id).once('value').then(function(snapshot) {
                $("#hdnId").val(snapshot.val().idSirket);
                $("#txtSirketAdi").val(snapshot.val().sirketAdi);
                $("#txtSirketAdresi").val(snapshot.val().sirketAdresi);
                $("#txtSirketTelefon").val(snapshot.val().sirketTelefon);
                $("#txtSirketSGKSicilNo").val(snapshot.val().sirketSGKSicilNo);
                $("#txtSirketIlgiliKisi").val(snapshot.val().sirketIlgiliKisi);
                $("#txtSirketTelefonCep").val(snapshot.val().sirketTelefonCep);
                $("#txtSirketEposta").val(snapshot.val().sirketEposta);
                $("#txtSirketIsyeriHekimi").val(snapshot.val().sirketIsyeriHekimi);
                $("#txtSirketIsyeriGuvenlikUzmani").val(snapshot.val().sirketIsGuvenligiUzmani);
                $('#myModal').modal('show');
            });
  // ...
}

        // firebase.database().ref('sirketler').child('idSirket').once(id).then(function (snapshot) {
        //     var rows = [];
        //     snapshot.forEach(function (element) {
                
        //         var cleanelement = JSON.parse(JSON.stringify(element));
        //         cleanelement['id'] = rows.length + 1;
        //         $("#hdnId").val(cleanelement[idSirket]);
        //         $("#txtSirketAdi").val(cleanelement[sirketAdi]);
        //         $("#txtSirketAdresi").val(cleanelement[sirketAdresi]);
        //         $("#txtSirketTelefon").val(cleanelement[sirketTelefon]);
        //         $("#txtSirketSGKSicilNo").val(cleanelement[sirketSGKSicilNo]);
        //         $("#txtSirketIlgiliKisi").val(cleanelement[sirketIlgiliKisi]);
        //         $("#txtSirketTelefonCep").val(cleanelement[sirketTelefonCep]);
        //         $("#txtSirketEposta").val(cleanelement[sirketEposta]);
        //         $("#txtSirketIsyeriHekimi").val(cleanelement[sirketIsyeriHekimi]);
        //         $("#txtSirketIsyeriGuvenlikUzmani").val(cleanelement[sirketIsGuvenligiUzmani]);
        //         $('#myModal').modal('show');
        //     });

        //     // grid.bootgrid("append", rows);
        // });
    //}}

</script>

<div class="page_container">
        <button id="myBtn"  data-toggle="modal" data-target="#myModal" class="btn-warning">Yeni Kayıt</button>
    <div class="row">
        <table id="grid-sirketler" class="table table-condensed table-hover table-striped">
            <thead>
                <tr>
                    <th data-column-id="idSirket" >Şirket Kodu</th>
                    <th data-column-id="sirketAdi">Şirket Adı</th>
                    <th data-column-id="sirketAdresi">Adresi</th>
                    <th data-column-id="sirketTelefon">Telefon</th>
                    <th data-column-id="sirketSGKSicilNo">SGKSicilNo</th>
                    <th data-column-id="sirketIlgiliKisi">İlgili Kişi</th>
                    <th data-column-id="sirketTelefonCep">Cep Telefonu</th>
                    <th data-column-id="sirketEposta">E-posta</th>
                    <th data-column-id="sirketIsyeriHekimi">İşyeri Hekimi</th>
                    <th data-column-id="sirketIsGuvenligiUzmani">İşGüvenliği Uzmanı</th> 
                    <th data-column-id="commands" data-formatter="commands" data-sortable="false">Commands</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div id="myModal" class="modal fade" role="document">
    <div class="modal-dialog">
            <div class="modal-content">
    <div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button> <h4 class="modal-title">Kayıt İşlemleri</h4></div>
        <div class="row modal-body">
    
            <div>
    
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Şirket Yeni Kayıt ve Güncelleme</h3>
                    </div>
    
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="txtSirketAdi">Şirket Adı</label>
                            <input type="text" class="form-control" id="txtSirketAdi" placeholder="ABC San. Tic. Aş.">
                            <input type="hidden" id="hdnId"/>
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketAdresi">Şirket Adresi</label>
                            <input type="text" class="form-control" id="txtSirketAdresi" placeholder="Sk. Cd. Organize Sanayi Bölgesi...">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketTelefon">Telefon</label>
                            <input type="telephone" class="form-control" id="txtSirketTelefon" placeholder="(+90 232) 111 22 33">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketSGKSicilNo">SGK Sicil No</label>
                            <input type="text" class="form-control" id="txtSirketSGKSicilNo" placeholder="SGK Sicil Numarası...">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketIlgiliKisi">İlgili Kişi</label>
                            <input type="text" class="form-control" id="txtSirketIlgiliKisi" placeholder="İlgili Kişi Adı Soyadı">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketTelefonCep">Mobil</label>
                            <input type="telephone" class="form-control" id="txtSirketTelefonCep" placeholder="(+90 232) 111 22 33">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketEposta">E-posta</label>
                            <input type="email" class="form-control" id="txtSirketEposta" placeholder="E-mail">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketIsyeriHekimi">İşyeri Hekimi</label>
                            <input type="text" class="form-control" id="txtSirketIsyeriHekimi" placeholder="İşyeri Hekimi Adı Soyadı">
                        </div>
    
                        <div class="form-group">
                            <label for="txtSirketIsyeriGuvenlikUzmani">İşyeri Hekimi</label>
                            <input type="text" class="form-control" id="txtSirketIsyeriGuvenlikUzmani" placeholder="İşyeri Güvenlik Uzamnı Adı">
                        </div>
    
    
                        <div class="form-group">
                            <label for="txtSirketIsGuvenligiUzmani">İlgili Kişi</label>
                            <input type="text" class="form-control" id="txtSirketIsGuvenligiUzmani" placeholder="İş Güvenliği Uzmanı Adı Soyadı">
                        </div>
    
    
                    </div>
                    <div class="panel-footer">
                        <button onclick="kaydetSirketBilgileri();return false;" class="btn btn-success btn-block">Kaydet</button>
                    </div>
                </div>
    
            </div>
    
            <div class="col-md-3"></div>
    
        </div>
    
            </div>
    </div>
    </div>

</div>
